"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.searchCommand = void 0;
const commander_1 = require("commander");
const index_1 = require("../../index");
const chalk_1 = __importDefault(require("chalk"));
const ora_1 = __importDefault(require("ora"));
const utils_1 = require("../utils");
exports.searchCommand = new commander_1.Command('search')
    .description('Search the web using AI')
    .requiredOption('-q, --query <text>', 'Search query')
    .option('--type <type>', 'Search type (web or image)', 'web')
    .option('--count <number>', 'Number of results', '10')
    .option('-H, --header <header>', 'Custom HTTP header (format: "Key: Value" or "Key=Value", can be used multiple times)', (value, previous) => previous.concat([value]), [])
    .option('--verbose', 'Enable verbose logging to print HTTP request details', false)
    .action(async (options) => {
    const spinner = (0, ora_1.default)('Searching...').start();
    try {
        const config = new index_1.Config();
        const customHeaders = (0, utils_1.parseHeaders)(options.header);
        const client = new index_1.SearchClient(config, customHeaders, options.verbose);
        let results;
        if (options.type === 'image') {
            results = await client.imageSearch(options.query, parseInt(options.count));
        }
        else {
            results = await client.webSearch(options.query, parseInt(options.count));
        }
        spinner.succeed(chalk_1.default.green('Search completed!'));
        if (options.type === 'image' && results.image_items) {
            results.image_items.forEach((item, index) => {
                console.log(chalk_1.default.cyan(`\n[${index + 1}] ${item.title || 'Image'}`));
                console.log(chalk_1.default.gray(item.url || ''));
                console.log(chalk_1.default.yellow(`Image URL: ${item.image.url}`));
            });
        }
        else if (results.web_items) {
            results.web_items.forEach((item, index) => {
                console.log(chalk_1.default.cyan(`\n[${index + 1}] ${item.title}`));
                console.log(chalk_1.default.gray(item.url || ''));
                if (item.snippet) {
                    console.log(item.snippet);
                }
            });
        }
    }
    catch (error) {
        spinner.fail(chalk_1.default.red('Search failed'));
        console.error(chalk_1.default.red(error.message));
        process.exit(1);
    }
});
//# sourceMappingURL=search.js.map