"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ASRClient = void 0;
const client_1 = require("../core/client");
const exceptions_1 = require("../core/exceptions");
const models_1 = require("./models");
class ASRClient extends client_1.BaseClient {
    constructor(config, customHeaders, verbose = false) {
        super(config, customHeaders, verbose);
    }
    /**
     * 识别音频文件中的语音内容
     *
     * 音频要求:
     * - 音频时长 ≤ 2小时
     * - 音频大小 ≤ 100MB
     * - 支持编码: WAV/MP3/OGG OPUS
     *
     * @param request - ASR 请求参数
     * @param request.uid - 用户唯一标识
     * @param request.url - 音频文件 URL (与 base64Data 二选一)
     * @param request.base64Data - Base64 编码的音频数据 (与 url 二选一)
     * @returns 识别结果，包含文本、时长和详细信息
     */
    async recognize(request) {
        if (!request.url && !request.base64Data) {
            throw new exceptions_1.ValidationError('必须提供 url 或 base64Data 其中之一');
        }
        const apiRequest = (0, models_1.buildASRApiRequest)(request);
        try {
            const response = await this.requestWithResponse('POST', `${this.config.baseUrl}/api/v3/auc/bigmodel/recognize/flash`, apiRequest);
            const statusCode = response.headers['x-api-status-code'] || '0';
            const message = response.headers['x-api-message'] || '';
            if (statusCode !== '20000000') {
                throw new exceptions_1.APIError(`ASR 识别失败，状态码: ${statusCode}, 错误信息: ${message}`, response.status, { code: statusCode, message });
            }
            const result = response.data.result || {};
            const text = result.text || '';
            return {
                text,
                duration: result.duration,
                utterances: result.utterances,
                rawData: response.data,
            };
        }
        catch (error) {
            if (error instanceof exceptions_1.APIError) {
                throw error;
            }
            throw new exceptions_1.APIError(`ASR 请求异常: ${error.message}`, 500);
        }
    }
}
exports.ASRClient = ASRClient;
//# sourceMappingURL=asr.js.map